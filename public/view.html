<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Post - Nadir Khan Sargiroh</title>
    <script>
      const API_BASE_URL = window.location.origin; 
    </script>

    <style>
        /* --- 1. RESET & BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #f4f4f4; font-family: 'Trebuchet MS', sans-serif; overflow-x: hidden; }

        /* --- 2. HEADER STYLES --- */
        .main-header { position: relative; z-index: 10; background: transparent; }
        .brand-bar {
            background: #A1A58F; width: 100%; height: 120px;
            padding: 10px 0; display: flex; flex-direction: column; align-items: center; position: relative;
        }
        .brand-logo-container { width: 100%; display: flex; justify-content: center; margin-bottom: 2px; cursor: pointer; }
        .header-title-img { max-width: 90%; height: auto; object-fit: contain; }
        .divider-line { width: 90%; height: 1px; background: #818472; border: 1px solid #818472; margin: 5px auto; }
        .brand-subtitle {
            font-family: 'Trebuchet MS', sans-serif; font-weight: 700; font-size: 19px;
            text-align: center; text-transform: uppercase; color: #000; text-shadow: 0px 2px 3px #A9B37C;
        }
        .header-mid-border { width: 100%; height: 5px; background: #616357; }

        /* --- 3. NAVIGATION (Search & Urdu Bar) --- */
        .nav-bar {
            background: #DDD0EA; width: 100%; display: flex; flex-direction: column;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
        }
        .nav-search-row {
            display: flex; width: 100%; justify-content: space-between; align-items: center; 
            padding: 5px 16px; height: 50px; direction: ltr; 
        }
        .search-container {
            display: flex; align-items: center; background: #FFFFFF; border-radius: 5px;
            height: 30px; flex-grow: 1; margin-right: 15px; overflow: hidden;
        }
        .search-input { width: 100%; border: none; outline: none; padding: 0 10px; font-family: 'Jameel Noori Nastaleeq', serif; text-align: right; font-size: 14px; }
        .search-btn { background: #7E816F; border: none; width: 35px; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .nav-icon { width: 30px; height: 30px; cursor: pointer; }

        .urdu-nav-links {
            display: flex; justify-content: space-around; align-items: center;
            padding: 8px 10px; border-top: 1px solid rgba(0,0,0,0.1);
        }
        .urdu-nav-links a {
            text-decoration: none; color: #4b2c61; font-family: 'Jameel Noori Nastaleeq', serif;
            font-size: 18px; font-weight: bold;
        }

        /* --- 4. ACTION BAR --- */
        .action-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 16px; background: white; border-bottom: 1px solid #eee; direction: ltr;
        }
        .social-group { display: flex; gap: 15px; align-items: center; }
        .action-icon { width: 30px; cursor: pointer; transition: 0.2s; }
        .action-icon:hover { transform: scale(1.1); }

        /* --- 5. CONTENT STYLES --- */
        .view-container {
            max-width: 800px; margin: 20px auto; background: white;
            padding: 20px; border-radius: 8px; direction: rtl;
        }
        .title-header {
            display: flex; justify-content: space-between; align-items: baseline;
            margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .post-full-title { font-family: 'Jameel Noori Nastaleeq', serif; font-size: 32px; color: #000; margin: 0; }
        .post-full-date { font-family: Arial, sans-serif; font-size: 14px; color: #666; direction: ltr; }
        .post-full-content {
            font-family: 'Jameel Noori Nastaleeq', serif; font-size: 24px; text-align: right;
            line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; color: #222;
        }
        .media-wrapper { width: 100%; margin-bottom: 20px; border-radius: 5px; overflow: hidden; background: #000; }
        .audio-box { background: #E7EBD6; padding: 30px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; gap: 20px; }

        /* --- 6. SIDEBAR MENU --- */
        .side-menu {
            position: fixed; top: 130px; right: -300px; width: 272px;
            background: rgba(231, 235, 214, 0.95); border: 1px solid #CACCC4;
            border-radius: 0 0 0 10px; z-index: 3000; transition: right 0.4s ease-in-out;
            box-shadow: -2px 5px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding-bottom: 10px;
        }
        .side-menu.open { right: 0; }
        .menu-header-row { width: 100%; display: flex; justify-content: flex-end; padding: 10px 15px; direction: ltr; }
        .close-btn { cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; text-decoration: none; transition: background 0.2s; direction: ltr; }
        .text-en { font-family: 'Times New Roman', serif; font-size: 22px; }
        .text-ur { font-family: 'Jameel Noori Nastaleeq', serif; font-size: 22px; font-weight: 700; text-align: right; }
        .color-green { color: #444A25; }
        .color-gold { color: #82733B; }
        .menu-divider { height: 1px; background: rgba(0, 0, 0, 0.16); margin: 2px 20px; }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 2500; opacity: 0; visibility: hidden; transition: 0.3s; }
        .menu-overlay.show { opacity: 1; visibility: visible; }

        /* --- 7. SEARCH DROPDOWN --- */
        .search-dropdown { position: absolute; top: 100%; left: 0; width: 100%; background: #FFFFFF; border: 1px solid #CACCC4; border-top: none; border-radius: 0 0 5px 5px; box-shadow: 0px 4px 8px rgba(0,0,0,0.1); z-index: 2000; display: none; max-height: 300px; overflow-y: auto; text-align: right; }
        .dropdown-item { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; text-decoration: none; border-bottom: 1px solid #f0f0f0; transition: background 0.2s; direction: ltr; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="brand-bar">
            <div class="brand-logo-container" onclick="location.href='index.html'">
                <img src="./assets/images/Header Title.png" class="header-title-img">
            </div>
            <div class="divider-line"></div>
            <h1 class="brand-subtitle">NADIR KHAN SARGIROH URDU VOCABULARY</h1>
        </div>
        <div class="header-mid-border"></div>
        
        <div class="nav-bar">
            <div class="nav-search-row">
                <div class="search-wrapper" style="position: relative; flex-grow: 1; margin-right: 15px;">
                    <div class="search-container" style="margin-right: 0;">
                        <input type="text" placeholder="تلاش...." class="search-input" autocomplete="off">
                        <button class="search-btn"><img src="./assets/icons/search.svg"></button>
                    </div>
                    <div id="search-results-dropdown" class="search-dropdown"></div>
                </div>
                <img src="./assets/icons/menu.svg" class="nav-icon" id="menu-btn">
            </div>
            <div class="urdu-nav-links">
                <a href="category.html?type=article">مضامین</a>
                <a href="category.html?type=audio">الفاظ کی دنیا</a>
                <a href="category.html?type=humor">طنز و مزاح</a>
                <a href="category.html?type=video">ویڈیوز</a>
                <a href="javascript:void(0)" onclick="toggleMenu()">مزید...</a>
            </div>
        </div>

        <div class="action-bar">
            <img src="./assets/icons/Back.svg" class="action-icon" onclick="history.back()">
            <div class="social-group">
                <img src="./assets/icons/whatsapp.svg" class="action-icon" onclick="shareTo('whatsapp')">
                <img src="./assets/icons/facebook.svg" class="action-icon" onclick="shareTo('facebook')">
                <img src="./assets/icons/share.svg" class="action-icon" onclick="nativeShare()">
            </div>
        </div>
    </header>

    <main class="view-container">
        <div id="post-view-content">
            <div style="text-align: center; padding: 50px;">تحریر لوڈ ہو رہی ہے...</div>
        </div>
    </main>

    <div id="side-menu" class="side-menu">
        <div class="menu-header-row">
            <div id="close-menu-btn" class="close-btn">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18" stroke="#525545" stroke-width="2.5" stroke-linecap="round"/><path d="M6 6L18 18" stroke="#525545" stroke-width="2.5" stroke-linecap="round"/></svg>
            </div>
        </div>
        <div class="menu-content" id="dynamic-side-menu"></div>
    </div>
    <div id="menu-overlay" class="menu-overlay"></div>

    <script>
        // 1. Sidebar Sync Logic
        async function syncSidebar() {
            try {
                const res = await fetch(`${API_BASE_URL}/api/categories`);
                const categories = await res.json();
                const sideContainer = document.getElementById('dynamic-side-menu');
                
                let menuHTML = `<a href="index.html" class="menu-item"><span class="text-en color-green">Home</span><span class="text-ur color-green">سَر وَرَق</span></a><div class="menu-divider"></div>`;
                
                menuHTML += categories.map((cat, index) => {
                    const colorClass = index % 2 === 0 ? 'color-gold' : 'color-green';
                    const nameEn = typeof cat === 'object' ? cat.nameEn : cat;
                    const nameUr = typeof cat === 'object' ? cat.nameUr : cat;
                    return `
                        <a href="category.html?type=${nameEn}" class="menu-item">
                            <span class="text-en ${colorClass}">${nameEn.charAt(0).toUpperCase() + nameEn.slice(1)}</span>
                            <span class="text-ur ${colorClass}">${nameUr}</span>
                        </a>
                        <div class="menu-divider"></div>`;
                }).join('');
                sideContainer.innerHTML = menuHTML;
            } catch (err) { console.error("Sidebar sync failed", err); }
        }

        // 2. Content Player Logic
        async function loadContent() {
            try {
                const id = new URLSearchParams(window.location.search).get('id');
                const res = await fetch(`${API_BASE_URL}/api/posts/${id}`);
                const post = await res.json();
                const container = document.getElementById('post-view-content');

                const getMediaPath = (path) => (path && path.startsWith('/assets/uploads')) ? `${API_BASE_URL}${path}` : path;

                let mediaHtml = '';
                
                let cat = "";
                if (post.category) {
                    cat = (typeof post.category === 'object' ? post.category.nameEn : post.category).toLowerCase();
                }

                const fileUrl = (post.imageUrl || "").toLowerCase();
                const mainMedia = getMediaPath(post.imageUrl);

                // Added nodownload and disabled right-click context menu
                if (cat.includes('video') || fileUrl.match(/\.(mp4|webm|mov)$/)) {
                    mediaHtml = `
                        <div class="media-wrapper">
                            <video src="${mainMedia}" controls controlsList="nodownload" oncontextmenu="return false;" autoplay loop style="width:100%; border-radius:8px;"></video>
                        </div>`;
                } 
                else if (cat.includes('audio') || cat.includes('آواز') || fileUrl.match(/\.(mp3|wav|m4a)$/)) {
                    const cover = getMediaPath(post.thumbnailUrl) || './assets/images/Header Title.png';
                    mediaHtml = `
                        <div class="audio-box" style="background: #E7EBD6; padding: 20px; border-radius: 12px; text-align: center;">
                            <img src="${cover}" style="width:100%; max-width:350px; border-radius:10px; margin-bottom:15px;" onerror="this.src='./assets/images/Header Title.png'">
                            <audio src="${mainMedia}" controls controlsList="nodownload" oncontextmenu="return false;" style="width:100%"></audio>
                        </div>`;
                } 
                else {
                    let displayImg = post.thumbnailUrl;
                    if (!displayImg) {
                        displayImg = (Array.isArray(post.imageUrl) && post.imageUrl.length > 0) ? post.imageUrl[0] : post.imageUrl;
                    }
                    const finalImg = getMediaPath(displayImg);
                    if (finalImg) {
                        mediaHtml = `<img src="${finalImg}" style="width:100%; border-radius:5px; margin-bottom:20px;" onerror="this.style.display='none'">`;
                    }
                }

                container.innerHTML = `
                    ${mediaHtml}
                    <div class="title-header">
                        <h1 class="post-full-title">${post.title || ''}</h1>
                        <span class="post-full-date">${post.date || ''}</span>
                    </div>
                    <div class="post-full-content">${post.content || ''}</div>
                `;
            } catch (err) {
                console.error("Content load failed", err);
            }
        }

        // 3. UI Helpers
        function handleSearch() {
            const keyword = document.querySelector('.search-input').value.trim();
            if (keyword) window.location.href = `category.html?search=${encodeURIComponent(keyword)}`;
        }

        function toggleMenu() {
            document.getElementById('side-menu').classList.toggle('open');
            document.getElementById('menu-overlay').classList.toggle('show');
        }

        function shareTo(platform) {
            const url = window.location.href;
            const text = document.querySelector('.post-full-title')?.innerText || "Nadir Khan Sargiroh";
            if (platform === 'whatsapp') window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text + " " + url)}`);
            if (platform === 'facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
        }

        async function nativeShare() {
            try { await navigator.share({ title: document.querySelector('.post-full-title')?.innerText, url: window.location.href }); } catch (err) {}
        }

        document.addEventListener('DOMContentLoaded', () => {
            syncSidebar();
            loadContent();

            document.getElementById('menu-btn').onclick = toggleMenu;
            document.getElementById('close-menu-btn').onclick = toggleMenu;
            document.getElementById('menu-overlay').onclick = toggleMenu;
            document.querySelector('.search-btn').onclick = handleSearch;
            document.querySelector('.search-input').onkeypress = (e) => { if (e.key === 'Enter') handleSearch(); };

            const searchInput = document.querySelector('.search-input');
            const dropdown = document.getElementById('search-results-dropdown');

            searchInput.addEventListener('input', async (e) => {
                const keyword = e.target.value.trim();
                if (keyword.length < 2) { dropdown.style.display = 'none'; return; }
                try {
                    const res = await fetch(`${API_BASE_URL}/api/posts?search=${encodeURIComponent(keyword)}`);
                    const posts = await res.json(); 
                    if (posts && posts.length > 0) {
                        dropdown.innerHTML = posts.map(p => `
                            <a href="view.html?id=${p._id}" class="dropdown-item">
                                <span class="item-title-ur">${p.title}</span>
                            </a>
                        `).join('');
                        dropdown.style.display = 'block';
                    } else dropdown.style.display = 'none';
                } catch (err) { console.error(err); }
            });
            document.addEventListener('click', (e) => { if (!searchInput.contains(e.target)) dropdown.style.display = 'none'; });
        });
    </script>
</body>
</html>